<div class="col-xs-12 col-sm-12 col-md-6 col-lg-8">
  <div class="widget">
    <div class="title">Notices</div>
    <table class="table table-striped table-responsive table-condensed">
      <thead>
        <tr>
          <th>#</th>
          <th>Response</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="Notices"></tbody>
    </table>
  </div>
</div>

<div class="col-xs-12 col-sm-12 col-md-6 col-lg-4">
  <div class="widget">
    <div class="title">Settings</div>
    <table class="table table-striped">
      <tr>
        <td><strong>Interval</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="noticeInterval" onclick="commons.configEditable(this, 'min')" id="configInterval"></abbr>
          <div class="input-group" style="display:none;" id="input_noticeInterval_group">
            <div class="input-group-addon">minutes</div>
            <input style="width: 6em" id="input_noticeInterval" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Minimal Messages Required</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="noticeMsgReq" onclick="commons.configEditable(this, '')" id="configMsgReq"></abbr>
          <div class="input-group" style="display:none;" id="input_noticeMsgReq_group">
            <input style="width: 6em" id="input_noticeMsgReq" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <div class="widget">
    <div class="title">Create Notice</div>
    <form class="form-horizontal">
      <div class="form-group">
        <div class="col-xs-offset-2 col-xs-8 col-sm-offset-2 col-sm-8 input-group">
          <div class="input-group-addon">Response</div>
          <input type="text" class="form-control" id="inputResponse" placeholder="e.g. You must know this">
        </div>
      </div>
      <div class="form-group">
        <div class="col-xs-12 col-sm-12 text-center">
          <button type="submit" class="btn btn-primary" onclick="notice.createNotice(event)">Create new notice</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  var notice = {
    updateNotices: function (list) {
      $("#Notices").empty()
      _.each(list, function(item, index) {
        $("#Notices").append('<tr>' +
          '<td>' + item.id + '</td>' +
          '<td>' + item.text + '</td>' +
          '<td class="tableMenu"><button type="button" class="btn btn-danger btn-xs" data-id="' + item.id + '" onclick="notice.deleteNotice(this)">[x] Delete</button></td>' +
          '</tr>');
      })
    },
    deleteNotice: function (el) {
      socket.emit('deleteNotice', el.dataset.id)
    },
    createNotice: function (event) {
      event.preventDefault()
      var data = {response: $("#inputResponse").val()}
      socket.emit('createNotice', data)
      $("#inputResponse").val('')
    }
  }

  socket.emit('getNotices');
  socket.emit('getNoticeConfiguration')

  socket.on('noticesConfiguration', function(data) {
    $("#configInterval").text(data.interval + 'min')
    $("#configMsgReq").text(data.msgreq)
  })

  socket.on('Notices', function(list) {
    notice.updateNotices(list)
  });
</script>