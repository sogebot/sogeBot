<ul class="nav nav-tabs">
  <li class="nav-item">
    <span data-lang="moderation" class="title text-default"></span>
  </li>
  <li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#links" data-lang="links"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#symbols" data-lang="symbols"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#long-messages" data-lang="long-messages"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#capitals" data-lang="capitals"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#spam" data-lang="spam"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#colors" data-lang="colors"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#emotes" data-lang="emotes"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#timeout-settings" data-lang="timeout-settings"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#blacklist" data-lang="timeout-blacklist"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#whitelist" data-lang="timeout-whitelist"></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#responses" data-lang="bot-responses"></a>
  </li>
</ul>

<div class="tab-content">
  <div role="tabpanel" class="tab-pane active" id="links">
    <div class="row settings">
      <div class="col">
        <strong data-lang="enabled"></strong>
      </div>
      <div class="col">
        <input id="moderationLinksToggle" type="checkbox" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationLinksTimeout" onclick="commons.configEditable(this, 's')" id="moderationLinksTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationLinksTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6rem" id="input_moderationLinksTimeout" class="form-control" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationLinksSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-spaces-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationLinksWithSpacesToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="symbols">
    <div class="row settings">
      <div class="col">
        <strong data-lang="enabled"></strong>
      </div>
      <div class="col">
        <input id="moderationSymbolsToggle" type="checkbox" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationSymbolsTimeout" onclick="commons.configEditable(this, 's')" id="moderationSymbolsTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationSymbolsTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6em" id="input_moderationSymbolsTimeout" class="form-control input-sm" type="text" />
        </div>
      </div>

      <div class="w-100"></div>
      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationSymbolsSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="trigger-length-of-message"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationSymbolsTriggerLength" onclick="commons.configEditable(this, '')" id="moderationSymbolsTriggerLength"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationSymbolsTriggerLength_group">
          <input style="width: 6em" id="input_moderationSymbolsTriggerLength" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="max-symbols-consecutively"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationSymbolsMaxConsecutively" onclick="commons.configEditable(this, '')"
          id="moderationSymbolsMaxConsecutively"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationSymbolsMaxConsecutively_group">
          <input style="width: 6em" id="input_moderationSymbolsMaxConsecutively" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="max-symbols-percentage"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationSymbolsMaxPercent" onclick="commons.configEditable(this, '%')" id="moderationSymbolsMaxPercent"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationSymbolsMaxPercent_group">
          <div class="input-group-addon">%</div>
          <input style="width: 6em" id="input_moderationSymbolsMaxPercent" class="form-control input-sm" type="text" />
        </div>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="long-messages">
    <div class="row settings">
      <div class="col">
        <strong data-lang="enabled"></strong>
      </div>
      <div class="col">
        <input id="moderationLongMessageToggle" type="checkbox" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationLongMessageTimeout" onclick="commons.configEditable(this, 's')" id="moderationLongMessageTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationLongMessageTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6em" id="input_moderationLongMessageTimeout" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationLongMessageSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="trigger-length-of-message"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationLongMessageTriggerLength" onclick="commons.configEditable(this, '')"
          id="moderationLongMessageTriggerLength"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationLongMessageTriggerLength_group">
          <input style="width: 6em" id="input_moderationLongMessageTriggerLength" class="form-control input-sm" type="text" />
        </div>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="capitals">
    <div class="row settings">
      <div class="col">
        <strong data-lang="enabled"></strong>
      </div>
      <div class="col">
        <input id="moderationCapsToggle" type="checkbox" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationCapsTimeout" onclick="commons.configEditable(this, 's')" id="moderationCapsTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationCapsTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6em" id="input_moderationCapsTimeout" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationCapsSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="trigger-length-of-message"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationCapsTriggerLength" onclick="commons.configEditable(this, '')" id="moderationCapsTriggerLength"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationCapsTriggerLength_group">
          <input style="width: 6em" id="input_moderationCapsTriggerLength" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="max-capitals-percentage"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationCapsMaxPercent" onclick="commons.configEditable(this, '%')" id="moderationCapsMaxPercent"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationCapsMaxPercent_group">
          <div class="input-group-addon">%</div>
          <input style="width: 6em" id="input_moderationCapsMaxPercent" class="form-control input-sm" type="text" />
        </div>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="spam">
    <div class="row settings">
      <div class="col">
        <strong data-lang="enabled"></strong>
      </div>
      <div class="col">
        <input id="moderationSpamToggle" type="checkbox" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationSpamTimeout" onclick="commons.configEditable(this, 's')" id="moderationSpamTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationSpamTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6em" id="input_moderationSpamTimeout" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationSpamSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="trigger-length-of-message"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationSpamTriggerLength" onclick="commons.configEditable(this, '')" id="moderationSpamTriggerLength"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationSpamTriggerLength_group">
          <input style="width: 6em" id="input_moderationSpamTriggerLength" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="max-spam-length"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationSpamMaxLength" onclick="commons.configEditable(this, '')" id="moderationSpamMaxLength"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationSpamMaxLength_group">
          <input style="width: 6em" id="input_moderationSpamMaxLength" class="form-control input-sm" type="text" />
        </div>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="colors">
    <div class="row settings">
      <div class="col">
        <strong data-lang="enabled"></strong>
      </div>
      <div class="col">
        <input id="moderationColorToggle" type="checkbox" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationColorTimeout" onclick="commons.configEditable(this, 's')" id="moderationColorTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationColorTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6em" id="input_moderationColorTimeout" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationColorSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="emotes">
    <div class="row settings">
      <div class="col">
        <strong data-lang="enabled"></strong>
      </div>
      <div class="col">
        <input id="moderationEmotesToggle" type="checkbox" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationEmotesTimeout" onclick="commons.configEditable(this, 's')" id="moderationEmotesTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationEmotesTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6em" id="input_moderationEmotesTimeout" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationEmotesSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="max-emotes-in-message"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationEmotesMaxCount" onclick="commons.configEditable(this, '')" id="moderationEmotesMaxCount"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationEmotesMaxCount_group">
          <input style="width: 6em" id="input_moderationEmotesMaxCount" class="form-control input-sm" type="text" />
        </div>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="timeout-settings">
    <div class="row settings">
      <div class="col">
        <strong data-lang="warnings-before-user-timeout"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationWarnings" onclick="commons.configEditable(this, '')" id="moderationWarnings"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationWarnings_group">
          <input style="width: 6em" id="input_moderationWarnings" class="form-control input-sm" type="text" />
        </div>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="warning-should-be-timeout"></strong>
      </div>
      <div class="col">
        <input id="moderationWarningsTimeoutsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="announce-timeouts-in-chat"></strong>
      </div>
      <div class="col">
        <input id="moderationAnnounceTimeoutsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="blacklist">
    <div class="row settings">
      <div class="col">
        <strong data-lang="timeout-blacklist"></strong>
        <small data-lang="one-record-per-line"></small>
      </div>
      <div class="w-100"></div>
      <div class="col">
        <textarea class="form-control" rows="10" id="blacklist-textarea"></textarea>
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="moderation-subscribers-toggle"></strong>
      </div>
      <div class="col">
        <input id="moderationBlacklistSubsToggle" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="danger">
      </div>
      <div class="w-100"></div>

      <div class="col">
        <strong data-lang="timeout-duration"></strong>
      </div>
      <div class="col">
        <abbr title="click to edit" data-config-id="moderationBlacklistTimeout" onclick="commons.configEditable(this, 's')" id="moderationBlacklistTimeout"></abbr>
        <div class="input-group" style="display:none;" id="input_moderationBlacklistTimeout_group">
          <div class="input-group-addon" data-lang="seconds"></div>
          <input style="width: 6em" id="input_moderationBlacklistTimeout" class="form-control input-sm" type="text" />
        </div>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="whitelist">
    <div class="row settings">
      <div class="col">
        <strong data-lang="timeout-whitelist"></strong>
        <small data-lang="one-record-per-line"></small>
      </div>
      <div class="w-100"></div>
      <div class="col">
        <textarea class="form-control" rows="10" id="whitelist-textarea"></textarea>
      </div>
    </div>
  </div>

  <div role="tabpanel" class="tab-pane" id="responses">
    <div class="widget" id="bot-responses"></div>
  </div>
</div>

<script>
  socket.emit('getConfiguration')
  socket.emit('moderation.lists.get')

  var createToggle = function (id, value, options) {
    options = options || {
      on: translations['on'],
      off: translations['off']
    }
    $('#' + id + 'Toggle').bootstrapToggle(options)
    $('#' + id + 'Toggle').bootstrapToggle(value ? 'on' : 'off')
    $('#' + id + 'Toggle').off('change')
    $('#' + id + 'Toggle').on('change', function () {
      var data = {}
      data[id] = $(this).prop('checked')
      if ($('#' + id + 'Toggle').data('init')) socket.emit('saveConfiguration', data)
    })
    $('#' + id + 'Toggle').data('init', true)
  }

  socket.once('configuration', function (data) {
    createToggle('moderationLinks', data.moderationLinks)
    createToggle('moderationLinksSubs', data.moderationLinksSubs)
    createToggle('moderationLinksWithSpaces', data.moderationLinksWithSpaces)
    $("#moderationLinksTimeout").text(data.moderationLinksTimeout + 's')

    createToggle('moderationSymbols', data.moderationSymbols)
    createToggle('moderationSymbolsSubs', data.moderationSymbolsSubs)
    $("#moderationSymbolsTimeout").text(data.moderationSymbolsTimeout + 's')
    $("#moderationSymbolsTriggerLength").text(data.moderationSymbolsTriggerLength)
    $("#moderationSymbolsMaxConsecutively").text(data.moderationSymbolsMaxConsecutively)
    $("#moderationSymbolsMaxPercent").text(data.moderationSymbolsMaxPercent + '%')

    createToggle('moderationLongMessage', data.moderationLongMessage)
    createToggle('moderationLongMessageSubs', data.moderationLongMessageSubs)
    $("#moderationLongMessageTimeout").text(data.moderationLongMessageTimeout + 's')
    $("#moderationLongMessageTriggerLength").text(data.moderationLongMessageTriggerLength)

    createToggle('moderationCaps', data.moderationCaps)
    createToggle('moderationCapsSubs', data.moderationCapsSubs)
    $("#moderationCapsTimeout").text(data.moderationCapsTimeout + 's')
    $("#moderationCapsTriggerLength").text(data.moderationCapsTriggerLength)
    $("#moderationCapsMaxPercent").text(data.moderationCapsMaxPercent + '%')

    createToggle('moderationSpam', data.moderationSpam)
    createToggle('moderationSpamSubs', data.moderationSpamSubs)
    $("#moderationSpamTimeout").text(data.moderationSpamTimeout + 's')
    $("#moderationSpamTriggerLength").text(data.moderationSpamTriggerLength)
    $("#moderationSpamMaxLength").text(data.moderationSpamMaxLength)

    createToggle('moderationColor', data.moderationColor)
    createToggle('moderationColorSubs', data.moderationColorSubs)
    $("#moderationColorTimeout").text(data.moderationColorTimeout + 's')

    createToggle('moderationEmotes', data.moderationEmotes)
    createToggle('moderationEmotesSubs', data.moderationEmotesSubs)
    $("#moderationEmotesTimeout").text(data.moderationEmotesTimeout + 's')
    $("#moderationEmotesMaxCount").text(data.moderationEmotesMaxCount)

    createToggle('moderationBlacklistSubs', data.moderationBlacklistSubs)
    $("#moderationBlacklistTimeout").text(data.moderationBlacklistTimeout + 's')

    $("#moderationWarnings").text(data.moderationWarnings)
    createToggle('moderationWarningsTimeouts', data.moderationWarningsTimeouts, {
      on: translations['will-timeout'],
      off: translations['warning']
    })

    $("#moderationAnnounceTimeouts").text(data.moderationAnnounceTimeouts)
    createToggle('moderationAnnounceTimeouts', data.moderationAnnounceTimeouts, {
      on: translations['announce'],
      off: translations['muted']
    })
  })

  socket.off('moderation.lists')
  socket.on('moderation.lists', function (lists) {
    $('#blacklist-textarea').val(!_.isNil(lists.blacklist) ? lists.blacklist.join('\n') : '')
    $('#whitelist-textarea').val(!_.isNil(lists.whitelist) ? lists.whitelist.join('\n') : '')
  })

  $('#blacklist, #whitelist').off().on('focusout', function (ev) {
    socket.emit('moderation.lists.set', {
      blacklist: $('#blacklist-textarea').val().split('\n'),
      whitelist: $('#whitelist-textarea').val().split('\n')
    })
  })

  var moderation = {
    responses: (id) => {
      id = id || null
      let system = 'moderation'
      socket.emit('responses.get', system, function (data) {
        for (let [key, entry] of Object.entries(data)) {
          if (!_.isNil(id) && `${system}.${key}` !== id) continue // continue if we want only specific id
          if (!_.isNil(id)) {
            $(`abbr[data-id="${id}"]`).text(entry)
            $(`abbr[data-id="${id}"]`).focus()
            $(`abbr[data-id="${id}"]`).blur()
            break
          }

          var filters = ['global']

          let div = $('<div>')
            .css('padding', '4px 5px 4px 5px')
          let response = $('<span>')
            .text(translations['response'])
            .addClass('badge badge-primary badge-bot-response')
          let kbd = $('<kbd>')
            .text(key.replace(/-/g, ' '))
            .addClass('kbd-bot-response')
          let span = $('<span>').addClass('custom-response')
            .attr('data-id', `${system}.${key}`)


          $('#bot-responses').append(div.append(response).append(kbd).append(span))

          if (_.includes(['alias-was-not-found', 'alias-was-edited', 'alias-was-added', 'alias-was-enabled',
              'alias-was-disabled', 'alias-was-concealed', 'alias-was-exposed', 'alias-was-removed'
            ], key)) filters.push('alias')
          if (_.includes(['list-is-not-empty'], key)) filters.push('list')

          $(`[data-id="${system}.${key}"]`).html(commons.editable({
            text: entry,
            id: `${system}.${key}`,
            fnc: 'commons.setResponse',
            filters: filters
          }))
        }
      })
    }
  }

  moderation.responses()

</script>
